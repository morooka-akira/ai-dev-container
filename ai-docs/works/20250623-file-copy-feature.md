# Task 5-1: ファイルコピー機能の実装

## 作業日
2025年6月23日

## 作業概要
workspace startコマンド実行時に、設定ファイル（workspace.yml）で指定されたファイルを新しく作成されたワークスペースにコピーする機能を実装する。

## 設計・検討内容

### 1. 機能要件
- 設定ファイルの`copy_files`配列に指定されたファイルをコピー
- 相対パスと絶対パスの両方をサポート
- 存在しないファイルは警告を表示してスキップ
- ディレクトリ構造を保持してコピー
- エラーが発生しても処理を継続

### 2. 実装方針

#### 2.1 コピー処理のタイミング
- worktree作成成功後、ブランチ切り替え完了後に実行
- 事前コマンド実行の前に実行（Task 5-2で実装予定）

#### 2.2 ファイルパスの解決
- ソースパス: 現在のリポジトリルートからの相対パス
- デスティネーションパス: 新しいワークスペースのルートからの相対パス

#### 2.3 エラーハンドリング
- ファイルが存在しない: 警告メッセージを表示して続行
- 読み取り権限がない: 警告メッセージを表示して続行
- 書き込みエラー: 警告メッセージを表示して続行
- 全体的な処理は中断しない

### 3. 実装詳細

#### 3.1 workspace.rsへの追加
```rust
// workspace.rs内のcreate_workspace関数に追加
fn copy_files(&self, source_repo_path: &Path, workspace_path: &Path, copy_files: &[String]) {
    for file_path in copy_files {
        // 実装
    }
}
```

#### 3.2 必要な依存関係
- 標準ライブラリの`std::fs`を使用
- 追加のクレートは不要

## 作業リスト

1. [ ] workspace.rsに`copy_files`メソッドを追加
   - [ ] ファイルパスの解決ロジック
   - [ ] ファイルのコピー処理
   - [ ] ディレクトリ作成処理
   - [ ] エラーハンドリング

2. [ ] create_workspace関数からcopy_filesメソッドを呼び出し
   - [ ] worktree作成成功後に呼び出し
   - [ ] 設定ファイルのcopy_filesを渡す

3. [ ] テストの作成
   - [ ] ファイルが正常にコピーされるテスト
   - [ ] 存在しないファイルのスキップテスト
   - [ ] ディレクトリ構造を持つファイルのコピーテスト
   - [ ] エラー時の継続処理テスト

4. [ ] 統合テスト
   - [ ] 実際のworkspace startコマンドでファイルがコピーされることを確認

## テスト計画

### ユニットテスト
- `copy_files`メソッドの個別テスト
- モックファイルシステムを使用したテスト

### 統合テスト  
- テスト用の設定ファイルを作成
- テスト用のコピー対象ファイルを作成
- workspace startコマンドを実行
- 作成されたワークスペースにファイルが存在することを確認

## 注意事項
- シンボリックリンクのコピーは今回のスコープ外
- 大きなファイルのコピーでもUIがブロックしないよう配慮
- セキュリティ: パストラバーサル攻撃を防ぐためのパス検証